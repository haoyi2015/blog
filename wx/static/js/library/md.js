!function(e){"use strict";function t(e){return e=e.slice(),function(t){t&&s(t),a(e,function(e){for(t||(e.loaded=!0);e.onload&&e.onload.length;){var n=e.onload.shift();n.call(e)}})}}function n(e){var t=h.alias(e),o=h.get(t);if("js"===i(t)){if(!o)return s(new Error('failed to require "'+e+'"')),null;if(!o.exports){if("function"!==r(o.factory))throw new Error('failed to require "'+e+'"');try{o.factory.call(h,n,o.exports={},o)}catch(a){throw a.id=t,h.traceback=a}delete o.factory,l("require","["+t+"] factory called")}return o.exports}}function o(e){var t=h.alias(e),n=h.get(t);if("css"===i(t)){if(!n)throw new Error('failed to require "'+e+'"');if(!n.parsed){if("string"!==r(n.rawCSS))throw new Error('failed to require "'+e+'"');if(document.createStyleSheet)document.createStyleSheet().cssText=n.rawCSS;else{var o=document.createElement("style"),a=document.head||document.getElementsByTagName("head")[0];a.appendChild(o),o.appendChild(document.createTextNode(n.rawCSS))}delete n.rawCSS,n.parsed=!0}}}function r(e){var t;return null==e?t=String(e):(t=Object.prototype.toString.call(e).toLowerCase(),t=t.substring(8,t.length-1)),t}function a(e,t,n){if("object"==typeof e){var o,a,c=r(e);if(n=n||e,"array"===c||"arguments"===c||"nodelist"===c){for(o=0,a=e.length;a>o;o++)if(t.call(n,e[o],o,e)===!1)return}else for(o in e)if(e.hasOwnProperty(o)&&t.call(n,e[o],o,e)===!1)return}}function c(e){function t(){}return t.prototype=e,new t}function i(e){var t="js";return e.replace(m,function(e,n){t=n}),"js"!==t&&"css"!==t&&(t="unknown"),t}function l(){var t=(e.localStorage||{}).debug,n=u.call(arguments),o="color: #bada55",a=n.shift(),c=new RegExp(a.replace(/[.\/\\]/g,function(e){return"\\"+e}));a="%c"+a,(t&&"*"===t||c.test(t))&&(g!==a&&(console.groupEnd(g,o),console.group(g=a,o)),/string|number|boolean/.test(r(n[0]))&&(n[0]="%c"+n[0],n.splice(1,0,o)),console.log.apply(console,n))}function s(){console&&"function"===r(console.error)&&console.error.apply(console,arguments)}var u=Array.prototype.slice,d=e.localStorage,f={},h=c(f);h.version="0.3.8-2",h.options={prefix:"__SCRAT__",cache:!1,hash:"",timeout:15,alias:{},deps:{},urlPattern:null,comboPattern:null,combo:!1,maxUrlLength:2e3},h.cache={},h.traceback=null,f.config=function(e){var t=h.options;l("scrat.config",e),a(e,function(e,n){var o=t[n],c=r(o);"object"===c?a(e,function(e,t){o[t]=e}):("array"===c&&(e=o.concat(e)),t[n]=e)});try{t.hash!==d.getItem("__SCRAT_HASH__")&&(h.clean(),d.setItem("__SCRAT_HASH__",t.hash)),t.cache=t.cache&&!!t.hash}catch(n){t.cache=!1}return/\bscrat=([\w,]+)\b/.test(location.search)&&a(RegExp.$1.split(","),function(e){switch(e){case"nocache":h.clean(),t.cache=!1;break;case"nocombo":t.combo=!1}}),t},f.async=function(e,t){"string"===r(e)&&(e=[e]),l("scrat.async","require ["+e.join(", ")+"]");var o=new h.Reactor(e,function(){var o=[];a(e,function(e){o.push(n(e))}),t&&t.apply(h,o),l("scrat.async","["+e.join(", ")+"] callback called")});o.run()},f.define=function(e,t){l("scrat.define","["+e+"]");var n=h.options,o=h.cache[e];if(o?o.factory=t:h.cache[e]={id:e,loaded:!0,factory:t},n.cache)try{d.setItem(n.prefix+e,t.toString())}catch(r){n.cache=!1}},f.defineCSS=function(e,t,n){l("scrat.defineCSS","["+e+"]");var r=h.options;if(h.cache[e]={id:e,loaded:!0,rawCSS:t},n!==!1&&o(e),r.cache)try{d.setItem(r.prefix+e,t)}catch(a){r.cache=!1}},f.get=function(e){l("scrat.get","["+e+"]");var t,n=h.options,o=i(e),r=h.cache[e];return r?r:n.cache&&(t=d.getItem(n.prefix+e))?("js"===o?new Function('define("'+e+'",'+t+")")():"css"===o&&h.defineCSS(e,t,!1),h.cache[e].loaded=!1,h.cache[e]):null},f.clean=function(){l("scrat.clean");try{a(d,function(e,t){~t.indexOf(h.options.prefix)&&d.removeItem(t)}),d.removeItem("__SCRAT_HASH__")}catch(e){}},f.alias=function(e,t){var n=h.options.alias;if(arguments.length>1)return n[e]=t,h.alias(e);for(;n[e]&&e!==n[e];)switch(r(n[e])){case"function":e=n[e](e);break;case"string":e=n[e]}return e},f.load=function(e,t){"function"===r(t)&&(t={onload:t},"function"===r(arguments[2])&&(t.onerror=arguments[2]));var n,o,a=t.onerror||function(){},c=t.type||i(e),s="js"===c,u="css"===c,d=+navigator.userAgent.replace(/.*AppleWebKit\/(\d+)\..*/,"$1")<536,f=document.head||document.getElementsByTagName("head")[0],p=document.createElement(s?"script":"link"),g="onload"in p,m=setTimeout(a,1e3*(t.timeout||15));s?(p.type="text/javascript",p.async="async",p.src=e):(u&&(p.type="text/css",p.rel="stylesheet"),p.href=e),p.onload=p.onreadystatechange=function(){!p||p.readyState&&!/loaded|complete/.test(p.readyState)||(clearTimeout(m),p.onload=p.onreadystatechange=null,s&&f&&p.parentNode&&f.removeChild(p),t.onload&&t.onload.call(h),p=null)},p.onerror=function(o){if(clearTimeout(m),clearInterval(n),o=(o||{}).error||new Error("load url timeout"),o.message="Error loading url: "+e+". "+o.message,!t.onerror)throw o;t.onerror.call(h,o)},l("scrat.load","["+e+"]"),f.appendChild(p),u?(d||!g)&&(l("scrat.load","check css's loading status for compatible"),o=0,n=setInterval(function(){return(o+=20)>t.timeout||!p?(clearTimeout(m),void clearInterval(n)):void(p.sheet&&(clearTimeout(m),clearInterval(n),t.onload&&t.onload.call(h),p=null))},20)):s||t.onload&&t.onload.call(h)},f.Reactor=function(e,t){this.length=0,this.depends={},this.depended={},this.push.apply(this,e),this.callback=t};var p=h.Reactor.prototype;p.push=function(){function e(){0===--t.length&&t.callback()}var t=this,n=u.call(arguments);a(n,function(n){var r=h.alias(n),a=i(r),c=h.get(r),l=h.options.deps[r];if(c){if(t.depended[r]||c.loaded)return}else c=h.cache[r]={id:r,loaded:!1};c.onload||(c.onload=[]),t.depended[r]=1,null!=l&&t.push.apply(t,l),"css"===a&&!c.rawCSS&&!c.parsed||"js"===a&&!c.factory&&!c.exports?((t.depends[a]||(t.depends[a]=[])).push(c),++t.length,c.onload.push(e)):c.rawCSS&&o(r)})},p.run=function(){var e=this,n=h.options,o=n.combo,r=this.depends;return 0===this.length?this.callback():(l("reactor.run",r),a(r.unknown,function(t){h.load(e.genUrl(t.id),function(){t.loaded=!0})}),l("reactor.run","combo: "+o),void(o?a(["css","js"],function(o){var c=0,i=[],l=[];a(r[o],function(a,s){var u;c+a.id.length<n.maxUrlLength?(c+=a.id.length,i.push(a.id),l.push(a)):(u=t(l),h.load(e.genUrl(i),u,u),c=a.id.length,i=[a.id],l=[a]),s===r[o].length-1&&(u=t(l),h.load(e.genUrl(i),u,u))})}):a((r.css||[]).concat(r.js||[]),function(n){var o=t([n]);h.load(e.genUrl(n.id),o)})))},p.genUrl=function(e){"string"===r(e)&&(e=[e]);var t=h.options,n=t.combo&&t.comboPattern||t.urlPattern;switch(t.cache&&"css"===i(e[0])&&a(e,function(t,n){e[n]=t+".js"}),r(n)){case"string":n=n.replace("%s",e.join(","));break;case"function":n=n(e);break;default:n=e.join(",")}return n+(~n.indexOf("?")?"&":"?")+"_hash="+t.hash},a(f,function(e,t){n[t]=e});var g,m=/\.(js|css)(?=[?&,]|$)/i;e.require=h,e.define=h.define,e.defineCSS=h.defineCSS,e.module&&e.module.exports&&(e.module.exports=h)}(this);