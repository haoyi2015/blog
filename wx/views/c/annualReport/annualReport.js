var annualReport=avalon.define({$id:"annualReport",weekDayArr:["一","二","三","四","五","六","七"],wxOpenId:"",mainHeight:"",main1Height:"",main2Height:"",main3Height:"",customerFroms:"客栈该项信息不详",urls:{annualreport:CONST.DOMAIN.ONLINE.PMS,annualreportAPI:CONST.DOMAIN.ONLINE.API},uris:{annualreport:"/year/getYearReport",isBindAnn:"/api/wx/bound/relation/"},showDiv:{Div1:!0,Div2:!1,Div3:!1,Div4:!1,Div5:!1},page2:{days:"不详",msgSendNum:"不详"},page3:{servPeopleNum:"不详",saleNights:"不详"},page4:{servPeopleRank:"不详",regionName:"不详",totalCheckInRadio:"不详",avgCheckInRadio:"不详",totalCheckInRadioRank:"不详",fullRoomDays:"不详",regionTopfullRoomDays:"不详",monthNightsRate:[],totalCheckInRadioRank1:!1,overRate:!1},page5:{regionAgeRanges:[],ageRanges:[],maleRadio:"不详",femaleRadio:"不详",maleHeight:0,femaleHeight:0,malePos:"不详",femalePos:"不详"},page6:{preBookDay:"不详",topCheckIn:"不详",topWeekDay:"不详"},page7:{avgStayDay:"不详",avgCost:"不详",regionTopAvgCost:"不详"},page8:{channelOrderFees:"不详",channelMaxCost:{name:"不详",cost:"不详"}},page9:{favoriteRoomType:"不详",leastFavoriteRoomType:"不详",bestReturnRoomType:"不详",avgRoomPrice:"不详",regionAvgRoomPrice:"不详"},page10:{totalPoints:"不详",totalRank:"不详",x1:"不详",x2:"不详",x3:"不详",x4:"不详",x5:"不详"},getOpenId:function(){var e=tmsky.util.urlParams(),a=e.code,t=e.wxOpenId;t?(annualReport.wxOpenId=t,annualReport.getInn()):(tmsky.ui.dialog.loading("身份验证中，请稍等。。。"),$.get(annualReport.urls.annualreportAPI+"/api/wx/openId/"+a+"/MP4INN").done(function(e){return e.openid?(annualReport.wxOpenId=e.openid,void annualReport.getInn()):(tmsky.ui.dialog.loading.close(),void tmsky.ui.dialog.tips("微信认证失败","error"))}))},getInn:function(){var e=tmsky.util.timestampUrl(annualReport.urls.annualreportAPI+annualReport.uris.isBindAnn+annualReport.wxOpenId);$.get(e).done(function(e){200==e.status&&e.result.length?annualReport.initData():annualReport.toWxBind()}).always(function(){tmsky.ui.dialog.loading.close()})},toWxBind:function(){tmsky.ui.dialog.loading.close(),location.href="bind.html?wxOpenId="+annualReport.wxOpenId},DayNumOfMonth:function(e,a){var t=new Date(e,a,0);return t.getDate()},sortChannelOrderFees:function(e){return e&&e.length&&e.length>1&&(e=e.sort(function(e,a){return a.ivalue-e.ivalue})),e},getCustomerFroms:function(e,a){if(!tmsky.isEmpty(e)){for(var t=e.split(","),n=[],o=0,r=t.length;r>o&&(n.push(t[o]),!(n.length>=a));o++);annualReport.customerFroms=n.join("、")}},initData:function(){var e={from:"2015-01-01",openId:annualReport.wxOpenId,to:"2015-12-31"},a=tmsky.util.timestampUrl(annualReport.urls.annualreport+annualReport.uris.annualreport);tmsky.ui.dialog.loading("年报数据玩命搜集统计中，就差一步啦。。。"),$.get(a,e).done(function(e){if(200!==e.status)return $(".swiper-container").hide(),$(".no-data").show(),void tmsky.ui.dialog.loading.close();e.report.channelOrderFees=annualReport.sortChannelOrderFees(e.report.channelOrderFees),annualReport.getCustomerFroms(e.report.customerFroms,5),annualReport.mainHeight=.4*$(window).height(),annualReport.main1Height=.4*$(window).height(),annualReport.main3Height=.5*$(window).height(),annualReport.page2.days=e.report.days,annualReport.page2.msgSendNum=e.report.msgSendNum,annualReport.showDiv=annualReport.page2.msgSendNum<1e3?{Div1:!1,Div2:!1,Div3:!1,Div4:!1,Div5:!0}:annualReport.page2.msgSendNum<1e4?{Div1:!1,Div2:!1,Div3:!1,Div4:!0,Div5:!1}:annualReport.page2.msgSendNum<3e4?{Div1:!1,Div2:!1,Div3:!0,Div4:!1,Div5:!1}:annualReport.page2.msgSendNum<5e4?{Div1:!1,Div2:!0,Div3:!1,Div4:!1,Div5:!1}:{Div1:!0,Div2:!1,Div3:!1,Div4:!1,Div5:!1},annualReport.page3.servPeopleNum=e.report.servPeopleNum,annualReport.page3.saleNights=e.report.saleNights,annualReport.page4.servPeopleRank=e.report.servPeopleRank,annualReport.page4.regionName=e.report.regionName,annualReport.page4.totalCheckInRadio=(100*e.report.totalCheckInRadio).toFixed(2)+"%",e.report.totalCheckInRadioRank<1?(annualReport.page4.totalCheckInRadioRank1=!0,annualReport.page4.totalCheckInRadioRank=(100*e.report.totalCheckInRadioRank).toFixed(2)+"%"):annualReport.page4.totalCheckInRadioRank=e.report.totalCheckInRadioRank,annualReport.page4.avgCheckInRadio=parseInt(100*e.report.avgCheckInRadio)+"%",annualReport.page4.fullRoomDays=e.report.fullRoomDays,annualReport.page4.regionTopfullRoomDays=e.report.regionTopfullRoomDays;for(var a=0;12>a;a++){annualReport.page4.monthNightsRate[a]=0;for(var t=0;12>t;t++)e.report.monthNights[t]&&parseInt(e.report.monthNights[t].name.substring(5,7))==a+1&&(annualReport.page4.monthNightsRate[a]=parseInt(e.report.monthNights[t].ivalue/(annualReport.DayNumOfMonth(2015,a)*e.report.roomNum)*100))}(100*e.report.totalCheckInRadio).toFixed(2)>100&&(annualReport.page4.overRate=!0);for(var n=0,a=0;a<e.report.ageRanges.length;a++)n+=e.report.ageRanges[a].ivalue;for(var a=0;a<e.report.regionAgeRanges.length;a++)annualReport.page5.regionAgeRanges[a]=Math.round(100*e.report.regionAgeRanges[a].ivalue),annualReport.page5.ageRanges[a]=Math.round(e.report.ageRanges[a].ivalue/n*100);0==e.report.maleRadio?(annualReport.page5.maleRadio="不详",annualReport.page5.maleHeight=0):(annualReport.page5.maleRadio=parseInt(100*e.report.maleRadio)+"%",annualReport.page5.maleHeight=parseInt(100*e.report.maleRadio),annualReport.page5.malePos="0 -"+(100-annualReport.page5.maleHeight)+"px"),0==e.report.femaleRadio?(annualReport.page5.femaleRadio="不详",annualReport.page5.femaleHeight=0):(annualReport.page5.femaleRadio=parseInt(100*e.report.femaleRadio)+"%",annualReport.page5.femaleHeight=parseInt(100*e.report.femaleRadio),annualReport.page5.femalePos="0 -"+(100-annualReport.page5.femaleHeight)+"px"),annualReport.page6.preBookDay=e.report.preBookDay,annualReport.page6.topCheckIn=e.report.topCheckIn,annualReport.page6.topWeekDay=annualReport.weekDayArr[e.report.topWeekDay-1],annualReport.page7.avgStayDay=e.report.avgStayDay,annualReport.page7.avgCost=parseInt(e.report.avgCost),annualReport.page7.regionTopAvgCost=e.report.regionTopAvgCost.toFixed(2),annualReport.page8.channelOrderFees=e.report.channelOrderFees,annualReport.page9.favoriteRoomType=e.report.favoriteRoomType,annualReport.page9.leastFavoriteRoomType=e.report.leastFavoriteRoomType,annualReport.page9.bestReturnRoomType=e.report.bestReturnRoomType,annualReport.page9.avgRoomPrice=e.report.avgRoomPrice.toFixed(2),annualReport.page9.regionAvgRoomPrice=e.report.regionAvgRoomPrice.toFixed(2),annualReport.page10.totalPoints=(e.report.totalPoints/5).toFixed(2),annualReport.page10.totalRank=(100*e.report.totalRank).toFixed(2)+"%",annualReport.page10.x1=(100*e.report.totalCheckInRadio*.4+60).toFixed(2),annualReport.page10.x2=(50+50*e.report.fullRoomDays/365).toFixed(2),annualReport.page10.x3=(60+.04*e.report.avgCost*(e.report.totalCheckInRadio/.4)).toFixed(2),annualReport.page10.x4=(.6*Math.sqrt(.1*e.report.msgSendNum)+60).toFixed(2),annualReport.page10.x5=(.5*annualReport.page10.x3+.5*annualReport.page10.x2).toFixed(2),annualReport.page10.x2>98&&(annualReport.page10.x2=98),annualReport.page10.x3>95&&(annualReport.page10.x3=95),annualReport.echartsLine(),annualReport.echartsBar(),annualReport.echartsBar1(),annualReport.echartsRadar(),annualReport.swiper(),tmsky.ui.dialog.loading.close()}).always(function(){tmsky.ui.dialog.loading.close()})},echartsLine:function(){var e=echarts.init(document.getElementById("main"));option={tooltip:{trigger:"axis"},legend:{data:["月入住率 注：点击图表查看详情"],x:"center",y:"bottom"},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]}],yAxis:[{type:"value",axisLabel:{formatter:"{value}%"}}],series:[{name:"月入住率",type:"line",data:annualReport.page4.monthNightsRate}]};var a={color:["#fff"]};e.setTheme(a),window.onresize=e.resize,e.setOption(option)},echartsBar:function(){var e=echarts.init(document.getElementById("main1"));option1={title:{subtext:"注：点击图表显示详情",x:"center",y:"bottom"},tooltip:{trigger:"axis"},legend:{data:["您的客人",annualReport.page4.regionName+"房客"]},grid:{x:40,y:70,x2:40,y2:55,zlevel:-100,z:-100,borderWidth:"0",borderColor:"rgba(0,0,0,0)"},calculable:!1,xAxis:[{type:"category",data:["18岁以下","18-25岁","25-35岁","35-45岁","45岁以上"]}],yAxis:[{type:"value",axisLabel:{formatter:"{value}%"}}],series:[{name:"您的客人",type:"bar",data:annualReport.page5.ageRanges},{name:annualReport.page4.regionName+"房客",type:"bar",data:annualReport.page5.regionAgeRanges}]};var a={color:["#4c97e4","#f39253"]};e.setTheme(a),e.setOption(option1),window.onresize=e.resize},echartsBar1:function(){for(var e=[],a=[],t=0;t<annualReport.page8.channelOrderFees.length;t++)e[t]=annualReport.page8.channelOrderFees[t].name,a[t]=annualReport.page8.channelOrderFees[t].ivalue.toFixed(2);annualReport.page8.channelMaxCost.cost=Math.max.apply(null,a).toFixed(2);for(var t=0;t<annualReport.page8.channelOrderFees.length;t++)annualReport.page8.channelMaxCost.cost==annualReport.page8.channelOrderFees[t].ivalue.toFixed(2)&&(annualReport.page8.channelMaxCost.name=annualReport.page8.channelOrderFees[t].name);e.length>5&&(e=e.slice(0,5),a=a.slice(0,5));var n=echarts.init(document.getElementById("main3"));option3={calculable:!1,title:{subtext:"注：点击图表显示详情，数据为渠道贡献值前五名",x:"center",y:"bottom"},tooltip:{trigger:"axis"},grid:{x:80,y:70,x2:80,y2:55,zlevel:-100,z:-100,borderWidth:"0",borderColor:"rgba(0,0,0,0)"},xAxis:[{type:"category",data:e}],yAxis:[{type:"value",axisLabel:{formatter:"{value}￥"}}],series:[{name:"金额",type:"bar",data:a,markLine:{data:[{type:"average",name:"平均值"}]}}]},n.setOption(option3),window.onresize=n.resize;var o={color:["#f39253"]};n.setTheme(o)},echartsRadar:function(){var e=echarts.init(document.getElementById("main2"));option2={tooltip:{trigger:"axis"},polar:[{indicator:[{text:"营销指数",max:100},{text:"服务指数",max:100},{text:"吸金指数",max:100},{text:"管理指数",max:100},{text:"魅力指数",max:100}],center:["50%",200],radius:70}],calculable:!1,series:[{name:"指数",type:"radar",data:[{value:[annualReport.page10.x1,annualReport.page10.x2,annualReport.page10.x3,annualReport.page10.x4,annualReport.page10.x5],name:"各指数得分"}]}]};e.setTheme(2),e.setOption(option2),window.onresize=e.resize},swiper:function(){scaleW=window.innerWidth/320,scaleH=window.innerHeight/480;for(var e=document.querySelectorAll(".resize"),a=0;a<e.length;a++)e[a].style.width=parseInt(e[a].style.width)*scaleW+"px",e[a].style.height=parseInt(e[a].style.height)*scaleH+"px",e[a].style.top=parseInt(e[a].style.top)*scaleH+"px",e[a].style.left=parseInt(e[a].style.left)*scaleW+"px";new Swiper(".swiper-container",{direction:"vertical",preloadImages:!1,pagination:".swiper-pagination",mousewheelControl:!0,watchSlidesProgress:!0,lazyLoading:!0,lazyLoadingInPrevNext:!0,lazyLoadingOnTransitionStart:!0,onProgress:function(e){for(var a=0;a<e.slides.length;a++){var t=e.slides[a],n=t.progress,o=n*e.height/4;scale=1-Math.min(Math.abs(.5*n),1);var r=1-Math.min(Math.abs(n/2),.5);t.style.opacity=r,es=t.style,es.webkitTransform=es.MsTransform=es.msTransform=es.MozTransform=es.OTransform=es.transform="translate3d(0,"+o+"px,-"+o+"px) scaleY("+scale+")"}},onSetTransition:function(e,a){for(var t=0;t<e.slides.length;t++)es=e.slides[t].style,es.webkitTransitionDuration=es.MsTransitionDuration=es.msTransitionDuration=es.MozTransitionDuration=es.OTransitionDuration=es.transitionDuration=a+"ms"}})}});avalon.ready(function(){var e=tmsky.util.urlParams();"skip"==e.skipOpenId?(annualReport.wxOpenId=e.openId||"ogyI_t-_W7hD4KIwgdgIxRs0iIms",annualReport.getInn()):annualReport.getOpenId()});