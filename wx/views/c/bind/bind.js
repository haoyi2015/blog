var bind=avalon.define({$id:"bind",urls:[CONST.DOMAIN.ONLINE.API],uris:{bound:"/api/wx/bound/auth",relation:"/api/wx/bound/relation/"},userInfo:{username:"",password:""},bindAnnList:[],showOrhide:{isShow:!1,isHide:!1},wxOpenId:"",init:function(){var n=tmsky.util.urlParams(),i=n.code,e=n.wxOpenId;e?(bind.wxOpenId=e,bind.getInn()):$.get(bind.urls[0]+"/api/wx/openId/"+i+"/MP4INN").done(function(n){return n.openid?(bind.wxOpenId=n.openid,void bind.getInn()):void tmsky.ui.dialog.tips("微信认证失败","error")})},getInn:function(){var n=tmsky.util.timestampUrl(bind.urls[0]+bind.uris.relation+bind.wxOpenId);$.get(n).done(function(n){if(200==n.status)if(0===n.result.length)bind.showOrhide={isShow:!0,isHide:!1};else{bind.showOrhide={isShow:!1,isHide:!0};for(var i=0;i<n.result.length;i++)bind.bindAnnList.push(n.result[i].innName)}else tmsky.ui.dialog.tips("请求出错！","error")}).always(function(){tmsky.ui.dialog.loading.close()})},bind:function(){var n={userCode:bind.userInfo.username,passWord:bind.userInfo.password,wxOpenId:bind.wxOpenId},i=tmsky.util.timestampUrl(bind.urls[0]+bind.uris.bound);$.post(i,n).done(function(n){200==n.status?(bind.showOrhide={isShow:!1,isHide:!0},bind.userInfo={username:"",password:""},bind.getInn()):tmsky.ui.dialog.tips(n.message,"error")}).always(function(){tmsky.ui.dialog.loading.close()})},continueBind:function(){bind.showOrhide={isShow:!0,isHide:!1}},toRegister:function(){location.href="http://www.fanqiele.com/registe.html"},toAnnualReport:function(){location.href="annualReport.html?wxOpenId="+bind.wxOpenId}});bind.init();